{
  "version": 3,
  "sources": ["../src/wc/checkout.ts"],
  "sourcesContent": ["import type Udesly from \"../utils/udesly\";\nimport type {WooCommerceRootModel} from \"../store/wc-models\";\nimport Eta from '../utils/eta';\n\nEta.config.autoEscape = false;\n\n\nexport default class Checkout {\n    private templateFunction: any;\n    private itemsList?: Element;\n    private includeTaxes: boolean;\n\n    constructor(private udesly: Udesly<WooCommerceRootModel>, private checkoutWrapper: HTMLElement,) {\n\n        this.includeTaxes = window.udesly_frontend_options.wc.show_taxes === \"incl\";\n        this.handleItemsInOrder(this.checkoutWrapper.querySelector(\".w-commerce-commercecheckoutblockcontent\"));\n\n        this.handleCoupon();\n    }\n\n    handleCoupon() {\n        const couponForm = this.checkoutWrapper.querySelector('[data-node-type=\"commerce-checkout-discount-form\"]');\n        if (!couponForm) {\n            return;\n        }\n        const realCouponForm = document.querySelector('form#coupon_form');\n        if (!realCouponForm) {\n            return;\n        }\n\n        if (realCouponForm) {\n           realCouponForm.addEventListener('submit', e => {\n               e.preventDefault();\n               e.stopPropagation();\n               e.stopImmediatePropagation();\n               console.log('submitted');\n           }, true);\n        }\n    }\n\n    handleItemsInOrder(wrapper: HTMLElement) {\n        if(!wrapper) {\n            return;\n        }\n        const template = wrapper.querySelector('script[type=\"text/x-wf-template\"]').textContent;\n\n        this.templateFunction = Eta.compile(template);\n        \n        this.itemsList = wrapper.querySelector('.w-commerce-commercecheckoutorderitemslist');\n\n        this.udesly.on(\"woocommerce/cartChanged\", () => {\n            this.refreshItemsInOrder()\n        });\n        this.refreshItemsInOrder();\n    }\n\n    refreshItemsInOrder() {\n        const {count, items, subtotal, total} = this.udesly.getState().woocommerce;\n        if (!count) {\n            window.location = window.udesly_frontend_options.wc.cart_url;\n        }\n        this.refreshItems(items);\n    }\n\n    refreshItems(items: any[]) {\n        if (!this.itemsList) {\n            return;\n        }\n        this.itemsList.innerHTML = items.reduce((prev, next) => {\n            next.rowTotal = this.includeTaxes ? next.total : next.subtotal;\n            return prev+= Eta.render(this.templateFunction, next);\n        }, \"\");\n    }\n}"],
  "mappings": ";;;;;;;;AAEA,iBAAgB;AAEhB,mBAAI,OAAO,aAAa;AAGxB,qBAA8B;AAAA,EAK1B,YAAoB,QAA8C,iBAA+B;AAA7E;AAA8C;AAE9D,SAAK,eAAe,OAAO,wBAAwB,GAAG,eAAe;AACrE,SAAK,mBAAmB,KAAK,gBAAgB,cAAc;AAE3D,SAAK;AAAA;AAAA,EAGT,eAAe;AACX,UAAM,aAAa,KAAK,gBAAgB,cAAc;AACtD,QAAI,CAAC,YAAY;AACb;AAAA;AAEJ,UAAM,iBAAiB,SAAS,cAAc;AAC9C,QAAI,CAAC,gBAAgB;AACjB;AAAA;AAGJ,QAAI,gBAAgB;AACjB,qBAAe,iBAAiB,UAAU,OAAK;AAC3C,UAAE;AACF,UAAE;AACF,UAAE;AACF,gBAAQ,IAAI;AAAA,SACb;AAAA;AAAA;AAAA,EAIV,mBAAmB,SAAsB;AACrC,QAAG,CAAC,SAAS;AACT;AAAA;AAEJ,UAAM,WAAW,QAAQ,cAAc,qCAAqC;AAE5E,SAAK,mBAAmB,mBAAI,QAAQ;AAEpC,SAAK,YAAY,QAAQ,cAAc;AAEvC,SAAK,OAAO,GAAG,2BAA2B,MAAM;AAC5C,WAAK;AAAA;AAET,SAAK;AAAA;AAAA,EAGT,sBAAsB;AAClB,UAAM,CAAC,OAAO,OAAO,UAAU,SAAS,KAAK,OAAO,WAAW;AAC/D,QAAI,CAAC,OAAO;AACR,aAAO,WAAW,OAAO,wBAAwB,GAAG;AAAA;AAExD,SAAK,aAAa;AAAA;AAAA,EAGtB,aAAa,OAAc;AACvB,QAAI,CAAC,KAAK,WAAW;AACjB;AAAA;AAEJ,SAAK,UAAU,YAAY,MAAM,OAAO,CAAC,MAAM,SAAS;AACpD,WAAK,WAAW,KAAK,eAAe,KAAK,QAAQ,KAAK;AACtD,aAAO,QAAO,mBAAI,OAAO,KAAK,kBAAkB;AAAA,OACjD;AAAA;AAAA;AAhEX,IAAO,mBAAP;",
  "names": []
}
