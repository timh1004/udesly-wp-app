{
  "version": 3,
  "sources": ["../src/store/models/wordpress.ts", "../src/store/models.ts"],
  "sourcesContent": ["import { createModel } from '@rematch/core'\nimport { RootModel } from '../models'\nimport {triggerJQuery, triggerWebflowInteractions} from \"../../utils/triggers\";\n\nasync function getNonce() {\n   const nonce = sessionStorage.getItem('___wp_nonce') || undefined\n   const nonceSavedAt = Number(sessionStorage.getItem('___wp_nonce_saved')) || 0;\n   const lifespan = udesly_frontend_options.wp.lifespan;\n   if (!nonce || (Date.now() > (nonceSavedAt + lifespan))) {\n       const data = new FormData();\n       data.set('action', 'udesly_ajax_generate_nonce');\n       const newNonce = await (await fetch(udesly_frontend_options.wp.ajax_url, {method: \"POST\", body: data})).text();\n       sessionStorage.setItem('___wp_nonce', newNonce);\n       sessionStorage.setItem('___wp_nonce_saved', Date.now().toString());\n       return newNonce;\n   }\n   return nonce;\n}\n\nexport const wordpress = createModel<RootModel>()({\n    state: {\n        time: Date.now(),\n    },\n    reducers: {\n        formSentSuccessfully(state, payload) {\n            return {...state, time: Date.now()};\n        },\n        formError(state, payload) {\n            return {...state, time: Date.now()};\n        },\n        postsLoaded(state, payload) {\n            triggerJQuery('post-load');\n            triggerWebflowInteractions();\n            return state;\n        },\n    },\n    effects: (dispatch) => ({\n        async sendForm(payload, state) {\n          const {parent, data} = payload;\n\n          if (Date.now() < (state.wordpress.time + 2000)) {\n              parent.onFormError && parent.onFormError(\"Anti Spam check failed!\");\n              return;\n          }\n\n          if (data.get('contact_me_by_fax_only')) {\n              parent.onFormError && parent.onFormError(\"Anti Spam check failed!\");\n              return;\n          }\n\n            try {\n          const res = await fetch(window.udesly_frontend_options.wp.ajax_url, {\n              method: \"POST\",\n              body: data\n          });\n\n             const jsonData = await res.json();\n              if (jsonData.success) {\n                  dispatch.wordpress.formSentSuccessfully(jsonData.data);\n                  parent.onFormSuccess && parent.onFormSuccess();\n              } else {\n                  dispatch.wordpress.formError(jsonData.data || \"Failed to send form\");\n                  parent.onFormError && parent.onFormError(jsonData.data || \"Failed to send form\");\n                  return;\n              }\n          } catch (e) {\n              console.error(e);\n              dispatch.wordpress.formError(\"Failed to send form\");\n              parent.onFormError && parent.onFormError(\"Failed to send form\");\n          }\n\n        },\n        async loadPosts(payload) {\n            const data = new FormData();\n            data.set('action', \"udesly_ajax_query_pagination\");\n            data.set('query_name', payload.queryName);\n            data.set('paged', payload.paged);\n            data.set('security', await getNonce());\n            const response = await fetch(window.udesly_frontend_options.wp.ajax_url, {\n                method: \"POST\",\n                body: data\n            });\n            const jsonData = await response.json();\n            if (response.ok) {\n\n               payload.list.outerHTML = jsonData.data;\n               dispatch.wordpress.postsLoaded();\n            }\n        }\n    }),\n});", "import {Models} from \"@rematch/core\";\nimport { wordpress } from \"./models/wordpress\";\n\nexport interface RootModel extends Models<RootModel> {\n    wordpress: typeof wordpress\n}\n\nexport const models: RootModel = { wordpress }\n"],
  "mappings": ";;;;;;;;;AAIA,0BAA0B;AACvB,QAAM,QAAQ,eAAe,QAAQ,kBAAkB;AACvD,QAAM,eAAe,OAAO,eAAe,QAAQ,yBAAyB;AAC5E,QAAM,WAAW,wBAAwB,GAAG;AAC5C,MAAI,CAAC,SAAU,KAAK,QAAS,eAAe,UAAY;AACpD,UAAM,OAAO,IAAI;AACjB,SAAK,IAAI,UAAU;AACnB,UAAM,WAAW,MAAO,OAAM,MAAM,wBAAwB,GAAG,UAAU,CAAC,QAAQ,QAAQ,MAAM,QAAQ;AACxG,mBAAe,QAAQ,eAAe;AACtC,mBAAe,QAAQ,qBAAqB,KAAK,MAAM;AACvD,WAAO;AAAA;AAEX,SAAO;AAAA;AAGH,IAAM,YAAY,cAAyB;AAAA,EAC9C,OAAO;AAAA,IACH,MAAM,KAAK;AAAA;AAAA,EAEf,UAAU;AAAA,IACN,qBAAqB,OAAO,SAAS;AACjC,aAAO,IAAI,OAAO,MAAM,KAAK;AAAA;AAAA,IAEjC,UAAU,OAAO,SAAS;AACtB,aAAO,IAAI,OAAO,MAAM,KAAK;AAAA;AAAA,IAEjC,YAAY,OAAO,SAAS;AACxB,oBAAc;AACd;AACA,aAAO;AAAA;AAAA;AAAA,EAGf,SAAS,CAAC,aAAc;AAAA,UACd,SAAS,SAAS,OAAO;AAC7B,YAAM,CAAC,QAAQ,QAAQ;AAEvB,UAAI,KAAK,QAAS,MAAM,UAAU,OAAO,KAAO;AAC5C,eAAO,eAAe,OAAO,YAAY;AACzC;AAAA;AAGJ,UAAI,KAAK,IAAI,2BAA2B;AACpC,eAAO,eAAe,OAAO,YAAY;AACzC;AAAA;AAGF,UAAI;AACN,cAAM,MAAM,MAAM,MAAM,OAAO,wBAAwB,GAAG,UAAU;AAAA,UAChE,QAAQ;AAAA,UACR,MAAM;AAAA;AAGP,cAAM,WAAW,MAAM,IAAI;AAC1B,YAAI,SAAS,SAAS;AAClB,mBAAS,UAAU,qBAAqB,SAAS;AACjD,iBAAO,iBAAiB,OAAO;AAAA,eAC5B;AACH,mBAAS,UAAU,UAAU,SAAS,QAAQ;AAC9C,iBAAO,eAAe,OAAO,YAAY,SAAS,QAAQ;AAC1D;AAAA;AAAA,eAEC,GAAP;AACE,gBAAQ,MAAM;AACd,iBAAS,UAAU,UAAU;AAC7B,eAAO,eAAe,OAAO,YAAY;AAAA;AAAA;AAAA,UAIzC,UAAU,SAAS;AACrB,YAAM,OAAO,IAAI;AACjB,WAAK,IAAI,UAAU;AACnB,WAAK,IAAI,cAAc,QAAQ;AAC/B,WAAK,IAAI,SAAS,QAAQ;AAC1B,WAAK,IAAI,YAAY,MAAM;AAC3B,YAAM,WAAW,MAAM,MAAM,OAAO,wBAAwB,GAAG,UAAU;AAAA,QACrE,QAAQ;AAAA,QACR,MAAM;AAAA;AAEV,YAAM,WAAW,MAAM,SAAS;AAChC,UAAI,SAAS,IAAI;AAEd,gBAAQ,KAAK,YAAY,SAAS;AAClC,iBAAS,UAAU;AAAA;AAAA;AAAA;AAAA;;;AC/E3B,IAAM,SAAoB,CAAE;",
  "names": []
}
