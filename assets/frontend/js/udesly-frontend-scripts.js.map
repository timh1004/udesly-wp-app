{
  "version": 3,
  "sources": ["../src/store/index.ts", "../src/utils/udesly.ts", "../src/utils/init-udesly.ts", "../src/wp/index.ts", "../src/udesly-frontend-scripts.ts"],
  "sourcesContent": ["import { init } from '@rematch/core'\n\nexport async function initStore(woocommerce = false) {\n\n    const module = woocommerce ? await import('./wc-models') : await import('./models');\n\n    return init({models: module.models,\n        name: woocommerce? \"WP/WC Store\" : \"WP Store\",\n        redux: {\n        devtoolOptions: {\n            disabled: !DEV\n        }\n    },\n    plugins: [plugin()]});\n}\n\nconst plugin = () => ({\n    createMiddleware: rematchBag => (store) => (next) => (action) => {\n            const { type: actionType, payload } = action;\n            window.Udesly.emit(actionType, payload);\n            return next(action);\n        },\n})\n", "import type {RematchStore} from \"@rematch/core\";\nimport type {WooCommerceRootModel} from \"../store/wc-models\";\nimport type {RootModel} from \"../store/models\";\n\nexport default class Udesly<T = WooCommerceRootModel | RootModel> {\n    private eventTarget: EventTarget;\n\n    constructor(description: string = \"\", public store: RematchStore<T>) {\n        this.eventTarget = document.appendChild(document.createComment(description));\n    }\n\n    on(type: string, listener: (data: any) => void) {\n        this._listen(type, listener);\n    }\n\n    getState() {\n        return this.store.getState();\n    }\n\n    dispatch(type: string, payload?: any) {\n       return this.store.dispatch({type, payload});\n    }\n\n    private _listen(type: string, listener: (data: any) => void, options?: {}) {\n        this.eventTarget.addEventListener<CustomEvent>(type, (evt: CustomEvent) => {\n            listener(evt.detail)\n        }, options);\n    }\n\n    once(type: string, listener: (data: any) => void) {\n       this._listen(type, listener, {once: true});\n    }\n\n    off(type: string, listener: (data:any) => void) {\n        this.eventTarget.removeEventListener(type, listener);\n    }\n\n    emit(type: string, payload: any) {\n        setTimeout(() => {\n            this.eventTarget.dispatchEvent(new CustomEvent(type, { detail: payload }));\n        }, 1);\n    }\n}", "import Udesly from \"./udesly\";\nimport type {WooCommerceRootModel} from \"../store/wc-models\";\nimport type {RootModel} from \"../store/models\";\nimport type {RematchStore} from \"@rematch/core\";\n\nexport default function initUdesly<T = WooCommerceRootModel | RootModel>(store: RematchStore<T>) {\n    const funcs = Array.isArray(window.Udesly) ? window.Udesly : [];\n\n    const u = new Udesly<T>(\"udesly\", store);\n\n    window.Udesly = u;\n    funcs.forEach(fn => fn());\n\n    return u;\n}", "import type Udesly from \"../utils/udesly\";\nimport type {RootModel} from \"../store/models\";\n\nconst CURRENT_CLASSNAME = \"w--current\";\n\nexport const addCurrentClassToLinks = () => {\n    const currentPath = window.location.toString();\n\n    document.querySelectorAll(`a[href=\"${currentPath.slice(0,-1)}\"],a[href=\"${currentPath}\"]`).forEach( a => {\n        a.classList.add(CURRENT_CLASSNAME);\n    })\n}\n\nexport default function wp(udesly: Udesly<RootModel>) {\n    addCurrentClassToLinks();\n    handlePaginationElements(udesly);\n\n    udesly.on('wordpress/postsLoaded', () => {\n        handlePaginationElements(udesly);\n    })\n\n    document.querySelectorAll<HTMLFormElement>('form[data-ajax-action]').forEach( el => {\n\n        const wrapper = el.parentElement;\n\n        const done = wrapper.querySelector('.w-form-done');\n        const error = wrapper.querySelector('.w-form-fail');\n\n        const errorMessage = error.lastElementChild || error;\n\n        const submit = el.querySelector<HTMLInputElement>('input[type=submit]');\n        if (submit) {\n            submit.dataset['value'] = submit.value;\n        }\n\n        wrapper.onFormError = function(message) {\n            errorMessage.textContent = (message || \"Failed to send form\").toString();\n            error.style.display = \"inherit\";\n            if (submit) {\n                submit.value = submit.dataset['value'];\n            }\n\n        }\n\n        wrapper.onFormSuccess = function() {\n            el.style.display = \"none\";\n            done.style.display = \"inherit\";\n\n            if (submit) {\n                submit.value = submit.dataset['value'];\n            }\n            // TODO: add form redirect;\n        }\n\n        el.addEventListener('submit', e => {\n\n            done.style.display = \"none\";\n            error.style.display = \"none\";\n\n            if(submit) {\n                submit.value = submit.dataset['wait'];\n            }\n\n            e.preventDefault();\n            e.stopPropagation();\n            e.stopImmediatePropagation();\n\n            const data = new FormData(el);\n            data.set('action', \"udesly_ajax_\" + el.dataset.ajaxAction);\n            udesly.dispatch('wordpress/sendForm', {parent: el.parentElement, data});\n        })\n    });\n}\n\n\nfunction handlePaginationElements(udesly: Udesly<RootModel>) {\n    document.querySelectorAll<HTMLElement>('.w-pagination-wrapper').forEach( el => {\n        if (el.dataset['paginationInit']) {\n            return;\n        }\n\n        el.dataset['paginationInit'] = \"true\";\n\n        const queryName = el.dataset.query;\n        const paged = Number(el.dataset.paged);\n        const list = el.closest('.w-dyn-list');\n        el.querySelectorAll('.w-pagination-previous').forEach( button => {\n\n            button.addEventListener('click', () => {\n                udesly.dispatch('wordpress/loadPosts', {\n                    queryName,\n                    paged: paged - 1,\n                    list\n                })\n            }, true)\n\n        })\n        el.querySelectorAll('.w-pagination-next').forEach( button => {\n\n            button.addEventListener('click', () => {\n\n                udesly.dispatch('wordpress/loadPosts', {\n                    queryName,\n                    paged: paged + 1,\n                    list\n                })\n            }, true)\n\n        })\n    })\n}", "import {initStore} from \"./store\";\nimport initUdesly from \"./utils/init-udesly\";\nimport wp from \"./wp\";\n\nimport type {RootModel} from \"./store/models\";\nimport type {RematchStore} from \"@rematch/core\";\nimport type {WooCommerceRootModel} from \"./store/wc-models\";\nimport type Udesly from \"./utils/udesly\";\n\nif (window.safari) {\n    var lastBtn = null\n    document.addEventListener('click',function(e){\n        if (!e.target.closest) return;\n        lastBtn = e.target.closest('button, input[type=submit]');\n    }, true);\n    document.addEventListener('submit',function(e){\n        if (e.submitter) return;\n        var canditates = [document.activeElement, lastBtn];\n        for (var i=0; i < canditates.length; i++) {\n            var candidate = canditates[i];\n            if (!candidate) continue;\n            if (!candidate.form) continue;\n            if (!candidate.matches('button, input[type=button], input[type=image]')) continue;\n            e.submitter = candidate;\n            return;\n        }\n        e.submitter = e.target.querySelector('button, input[type=button], input[type=image]')\n    }, true);\n}\n\n(async() => {\n    const woocommerce = window.udesly_frontend_options.plugins.woocommerce;\n    const store = await initStore(woocommerce)\n\n    const udesly = woocommerce ?\n        initUdesly<WooCommerceRootModel>(store as RematchStore<WooCommerceRootModel>)\n       : initUdesly<RootModel>(store as RematchStore<RootModel>);\n\n\n    wp(udesly as Udesly<RootModel>);\n\n    if (woocommerce) {\n        const module = await import('./wc/index');\n        await module.default(udesly as Udesly<WooCommerceRootModel>)\n    }\n\n})();\n"],
  "mappings": "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",
  "names": []
}
