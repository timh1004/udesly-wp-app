(this["webpackJsonpfrontend-editor"]=this["webpackJsonpfrontend-editor"]||[]).push([[0],{407:function(e,t,n){},410:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(29),o=n.n(i),c=n(13),s=n(162),u=n(12),l=n.n(u),d=n(24),f=n(46),m=n(47),p=function(){function e(){Object(f.a)(this,e),this.accept=window.options.accept||"image/png, image/jpeg, image/jpg, image/gif",this.askedItems={}}return Object(m.a)(e,[{key:"uploadMedia",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,a,r,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).set("action","upload-attachment"),n.set("_wpnonce",window.options.nonce),n.set("async-upload",t),n.set("name",t.name),e.next=7,fetch(window.options.async_upload,{method:"POST",body:n});case 7:return a=e.sent,e.next=10,a.json();case 10:return r=e.sent,i=r.data,e.abrupt("return",{id:i.id,type:"file",directory:"",previewSrc:i.url,filename:i.filename});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"persist",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(s.a)(t),e.prev=1,n.s();case 3:if((a=n.n()).done){e.next=9;break}return r=a.value,e.next=7,this.uploadMedia(r.file);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"previewSrc",value:function(){var e=Object(d.a)(l.a.mark((function e(t,n,a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.previewSrc);case 1:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"list",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,a,r,i,o,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new FormData,a=Math.floor(t.offset/t.limit),n.set("action","query-attachments"),n.set("query[posts_per_page]",t.limit||40),n.set("query[paged]",0===a?1:a+1),e.next=7,fetch(window.options.ajax_url,{method:"POST",body:n});case 7:return r=e.sent,e.next=10,r.json();case 10:return i=e.sent,o=i.data.map((function(e){return{id:e.id,type:"file",directory:"",previewSrc:"video"===e.type?e.image.src:e.url,filename:e.filename,nonces:e.nonces}})),c={items:o,limit:t.limit,offset:t.offset},this.askedItems[a]=o.length,(s=Object.values(this.askedItems).reduce((function(e,t){return e+t}),0))===t.limit?c.totalCount=s+1:c.totalCount=s,e.abrupt("return",c);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).set("action","delete-post"),n.set("id",t.id),n.set("_wpnonce",t.nonces.delete),e.next=6,fetch(window.options.ajax_url,{method:"POST",body:n});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),g=n(36),h=n(163),b=function(e){var t=e.config,n=Object(c.useForm)(t,{fields:t.fields}),a=Object(g.a)(n,2),r=(a[0],a[1]);return Object(c.usePlugin)(r),Object(c.usePlugin)(h.HtmlFieldPlugin),""},v=function(e){var t=e.config,n=Object(c.useForm)(t),a=Object(g.a)(n,2),r=(a[0],a[1]);return Object(c.useFormScreenPlugin)(r,"","fullscreen"),""},x=n(10),y=function(e){var t=e.iframe,n=Object(a.useRef)();return Object(a.useEffect)((function(){n.current&&n.current.append(t)}),[n]),Object(x.jsx)("div",{className:"iframe-wrapper",ref:n})};var j,w,O,k=function(e){var t=e.pageConfig,n=e.globalConfig,r=e.iframe,i=new c.TinaCMS({media:new p,enabled:!0,toolbar:!0,sidebar:{position:"displace"}});return i.events.subscribe("cms:disable",(function(e){window.location=window.location.toString().replace(window.location.search,"")})),Object(a.useEffect)((function(){setTimeout((function(){document.querySelector('[aria-label="toggles cms sidebar"]').click(),document.body.classList.add("loaded");var e=document.querySelector("button[class*=ExitButton]");if(e){var t=Array.from(e.childNodes).find((function(e){return e.nodeType===Node.TEXT_NODE}));t&&(t.textContent="Close Frontend Editor")}}),20),document.addEventListener("udesly-fe.notice",(function(e){var t=e.detail;if(t&&t.message)switch(t.type){case"error":i.alerts.error(t.message);break;case"success":i.alerts.success(t.message);break;default:i.alerts.info(t.message)}}))}),[]),Object(x.jsxs)(c.TinaProvider,{cms:i,children:[Object(x.jsx)(y,{iframe:r}),Object(x.jsx)(b,{config:t}),Object(x.jsx)(v,{config:n})]})},S=(n(407),n(173));function E(e){return e[Object.keys(e).find((function(e){return e.startsWith("__reactProps$")}))]}function C(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Edit Page",a=arguments.length>2?arguments[2]:void 0,r={id:"random-"+Math.random(),label:n,fields:[],initialValues:{img:{},link:{},iframe:{},text:{},textarea:{},richtext:{}},onSubmit:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,i,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in(n=JSON.parse(JSON.stringify(t))).img)n.img[r].id&&"local"!==n.img[r].id?n.img[r]={id:n.img[r].id}:n.img[r]=n.img[r]._original;return(i=new FormData).append("action","update_frontend_editor_data"),i.append("security",window.options.save_nonce),i.append("data",JSON.stringify(n)),i.append("template",a),e.next=9,fetch(window.options.ajax_url,{method:"POST",body:i,contentType:"application/json",credentials:"same-origin"});case 9:if(!(o=e.sent).ok){e.next=17;break}return e.next=13,o.json();case 13:(c=e.sent).success?document.dispatchEvent(new CustomEvent("udesly-fe.notice",{detail:{type:"success",message:"Saved successfully!"}})):document.dispatchEvent(new CustomEvent("udesly-fe.notice",{detail:{type:"error",message:c.data||"Failed to save data! :("}})),e.next=18;break;case 17:document.dispatchEvent(new CustomEvent("udesly-fe.notice",{detail:{type:"error",message:"Failed to save data! :("}}));case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},i={};for(var o in e.img)i.img||(i.img={name:"img",component:"group",label:"Images",fields:[]}),i.img.fields.push({name:o,component:"image",clearable:!1,parse:function(e,t){return j.changeImage(t,e.previewSrc),e}}),r.initialValues.img[o]=e.img[o];for(var c in e.link)i.link||(i.link={name:"link",component:"group",label:"Links",fields:[{name:"null",component:function(){return Object(x.jsxs)("div",{children:["You have different ways to set your links:",Object(x.jsxs)("ul",{style:{whiteSpace:"break-spaces",fontSize:"80%"},children:[Object(x.jsxs)("li",{children:[Object(x.jsx)("strong",{children:"Absolute or Relative:"})," for example https://www.mysite.com, tel:+333333 or /home#about"]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("strong",{children:"Page slug:"}),' if you want to link to an inner page you should use the page slug, for example "about", "nested/page" or "index" to link to home page']})]})]})}}]}),i.link.fields.push({name:c,component:"text",parse:function(e,t){return j.changeAttribute(t,e,"href"),e}}),r.initialValues.link[c]=e.link[c];for(var s in e.iframe)i.iframe||(i.iframe={name:"iframe",component:"group",label:"Iframes and Videos",fields:[{name:"null",component:function(){return Object(x.jsxs)("div",{children:[Object(x.jsx)("p",{children:"Set the Absolute Url to the Video file or the Iframe, or a relative url (without the starting /) to the asset folder"}),Object(x.jsx)("p",{children:"(e.g: videos/my-video.mp4)"})," ",Object(x.jsx)("br",{})]})}}]}),i.iframe.fields.push({name:s,component:"text",parse:function(e,t){return j.changeAttribute(t,e,"src"),e}}),r.initialValues.iframe[s]=e.iframe[s];for(var u in e.text)i.text||(i.text={name:"text",component:"group",label:"Texts",fields:[]}),i.text.fields.push({name:u,component:e.text[u].length>35?"textarea":"text",parse:function(e,t){return j.changeInnerHTML(t,e),e}}),r.initialValues.text[u]=e.text[u];for(var f in e.textarea)i.textarea||(i.textarea={name:"textarea",component:"group",label:"Text Areas",fields:[]}),i.textarea.fields.push({name:f,component:"textarea",parse:function(e,t){return j.changeInnerHTML(t,e),e}}),r.initialValues.textarea[f]=e.textarea[f];for(var m in e.richtext)i.richtext||(i.richtext={name:"richtext",component:"group",label:"Rich Texts",fields:[]}),i.richtext.fields.push({name:m,component:"textarea",imageProps:{parse:function(e){return e.previewSrc},directory:function(){return""},previewSrc:function(e){return e}},parse:function(e,t){return j.changeInnerHTML(t,e),e}}),r.initialValues.richtext[m]=e.richtext[m];return(t=r.fields).push.apply(t,Object(S.a)(Object.values(i))),r}document.getElementById("udesly-frontend-editor").addEventListener("click",(function(e){if(e.target.matches('[data-tooltip="Heading"]')){var t=E(e.target);t&&"function"==typeof t.onClick&&t.onClick(e)}else if(e.target.closest('[data-tooltip="Heading"]')){var n=E(e.target.closest('[data-tooltip="Heading"]'));n&&"function"==typeof n.onClick&&n.onClick(e)}else{var a=e.target.closest("[class^=FieldWrapper]");if(O&&O.classList.remove("fe-focused"),a){var r=a.querySelector("label");if(!r||!r.htmlFor)return;var i=w.get(r.htmlFor);if(i[0]){var o="SOURCE"===i[0].tagName?i[0].parentElement:i[0];o.classList.add("fe-focused"),O&&O!==o&&(O.__scrolled=!1),O=o,o.__scrolled||(o.scrollIntoView({behavior:"smooth",block:"center"}),o.__scrolled=!0)}}}}));var I=function(){function e(){Object(f.a)(this,e),this.cache={}}return Object(m.a)(e,[{key:"get",value:function(e){var t=e.split("."),n=Object(g.a)(t,2),a=n[0],r=n[1];return this.cache[e]&&this.cache[e].length||(this.cache[e]=document.querySelector("#frontend-editor-frame").contentDocument.querySelectorAll("[data-".concat(a,'="').concat(r,'"]'))),this.cache[e]}}]),e}(),_=function(){function e(){Object(f.a)(this,e)}return Object(m.a)(e,[{key:"changeInnerHTML",value:function(e,t){w.get(e).forEach((function(e){e.innerHTML=t}))}},{key:"changeAttribute",value:function(e,t,n){w.get(e).forEach((function(e){e.setAttribute(n,t)}))}},{key:"changeImage",value:function(e,t){w.get(e).forEach((function(e){"IMG"===e.tagName?(e.removeAttribute("srcset"),e.removeAttribute("sizes"),e.setAttribute("src",t)):e.setAttribute("style","background-image: url('".concat(t,"')"))}))}}]),e}(),T=setInterval((function(){var e=document.getElementById("frontend-editor-frame"),t=e.contentDocument||e.contentWindow.document;"complete"===t.readyState&&t.getElementById("udesly-fe-data")&&(!function(){console.log("called");var e=document.getElementById("frontend-editor-frame").contentDocument,t=JSON.parse(e.getElementById("udesly-fe-data").textContent);j=new _,w=new I;var n=C(t.page,"Edit Page",t.template),a=C(t.global,"Symbols","global");document.dispatchEvent(new CustomEvent("udesly-fe.init",{detail:{pageConfig:n,globalConfig:a,iframe:document.getElementById("frontend-editor-frame")}}))}(),clearInterval(T))}),150);document.addEventListener("udesly-fe.init",(function(e){var t=e.detail,n=t.globalConfig,a=t.pageConfig,i=t.iframe;o.a.render(Object(x.jsx)(r.a.StrictMode,{children:Object(x.jsx)(k,{globalConfig:n,pageConfig:a,iframe:i})}),document.getElementById("udesly-frontend-editor"))}),{once:!0})}},[[410,1,2]]]);
//# sourceMappingURL=main.1197266e.chunk.js.map